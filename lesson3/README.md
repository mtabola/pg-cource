# Лекция 3: Система очистки, журнал предзаписи

## Ответы на вопросы

1. Создать таблицу с текстовым полем и заполнить случайными или сгенерированными данным в размере 1 млн строк
  <img width="619" alt="изображение" src="https://github.com/user-attachments/assets/2d06d94b-7dbf-43a2-9eed-47bec8e73759" />

2. Посмотреть размер файла с таблицей
  <img width="632" alt="изображение" src="https://github.com/user-attachments/assets/9fdf4477-7068-44ea-a611-9b20862718df" />

3. 5 раз обновить все строчки и добавить к каждой строчке любой символ
  <img width="371" alt="изображение" src="https://github.com/user-attachments/assets/ed182d7a-c5cf-4c85-bf40-c7851dcb0ae6" />

4. Посмотреть количество мертвых строчек в таблице и когда последний раз приходил автовакуум
  <img width="565" alt="изображение" src="https://github.com/user-attachments/assets/e1361966-14c6-45f4-9fc4-6e69c0689053" />

5. Подождать некоторое время, проверяя, пришел ли автовакуум
  <img width="581" alt="изображение" src="https://github.com/user-attachments/assets/dca6125d-ccd2-4f60-b36d-01ecd1cd5e0d" />
  
6. 5 раз обновить все строчки и добавить к каждой строчке любой символ
7. Посмотреть размер файла с таблицей
  <img width="712" alt="изображение" src="https://github.com/user-attachments/assets/4412afbc-4f5e-4453-bf86-15e2d22d6538" />

8. Отключить Автовакуум на конкретной таблице
9. 10 раз обновить все строчки и добавить к каждой строчке любой символ
10. Посмотреть размер файла с таблицей
  <img width="691" alt="изображение" src="https://github.com/user-attachments/assets/7c29f296-f4aa-4e85-816b-f8d182d4b630" />

11. Объясните полученный результат

Когда мы делаем `UPDATE`, то по сути мы делаем `INSERT` + `DELETE`, поэтому у нас появляется много мертвых строк, которые не вычищаются вакуумом, т.к он отключен.

12. Не забудьте включить автовакуум
  <img width="447" alt="изображение" src="https://github.com/user-attachments/assets/63034a0d-fc83-4c32-9b9e-f88020cf0d5a" />


\* - Написать анонимную процедуру, в которой в цикле 10 раз обновятся все строчки в
искомой таблице. Не забыть вывести номер шага цикла.
Код:
```sql
DO $$
BEGIN
    FOR i IN 1..10 LOOP
        RAISE NOTICE 'Цикл: %', i;
        UPDATE test
        SET txt = (txt || CHR(97 + i));
    END LOOP;
    COMMIT;
END $$;
```
